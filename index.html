<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Eiffel Tower on Mapbox</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <!-- Include the Mapbox GL CSS -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body, html { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <!-- Include the Mapbox GL JS -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js'></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFydWNoYW5uIiwiYSI6ImNsdnFlZWRidTAyNmkya21yem1wMjhzZHUifQ.GrEXJlVvv0ljdkQXoEQTTQ';
    const map = new mapboxgl.Map({
      container: 'map', // container ID
      style:  'mapbox://styles/haruchann/clvqqksup01r901qpg3d0hynv',  // style URL
      center: [2.2945, 48.8584], // initial center coordinates
      zoom: 1.3, // initial zoom
      pitch: 0, // pitch in degrees
      bearing: 0 // bearing in degrees
    });


    map.addControl(new mapboxgl.NavigationControl());

    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style
    });

  const newsArticles = [
      {
        title: "OECD Meeting",
        date: "05/03/2024",
        content: "There was a meeting at the OECD.",
        location: [2.269388576037927,48.86150995466904 ]
      },
{
  "title": "Saudi Steel Market Update",
  "date": "05/03/2024",
  "content": "Jubail-based mill offers rebar-grade billet at SAR 2,030/t. Scrap flows improving but prices remain firm. Induction furnace-route billet prices steady nationwide. Riyadh rebar prices below re-rollers’ procurement cost.",
  "location": [49.660455865746,27.015762770190104, ]
},
{
  "title": "US Steel Updates and Outlook",
  "date": "05/03/2024",
  "content": "US Steel commissions new coating line at Big River Steel. First-quarter earnings show decline in net earnings and net sales. Adjusted Ebitda slightly below guidance but reflects efficient operations amidst market changes. CEO anticipates stronger second quarter.",
  "location": [ -89.59850503968177,38.73332565415621]
},
{
  "title": "ArcelorMittal Restocking Outlook",
  "date": "05/03/2024",
  "content": "ArcelorMittal observes a waiting period for a rebound in restocking. Sentiment stabilizes, awaiting consumption increase due to low inventory levels.European steel spreads improve, US prices stabilize influenced by low inventory. Challenges noted from China’s excess steel production and rising exports.",
  "location": [6.137289730816212,49.60491267530501]
},
{
        title: "Gerdau conciders building new SBQ in Mexico",
        date: "05/03/2024",
        content: "Gerdau is exploring the development of a new special bar quality (SBQ) mill in Mexico to cater to the automotive industry and planning a feasibility study for the project, which would use scrap as feedstock to minimize carbon emissions. ",
        location: [-46.69750025410008,-23.57348219857006, ]
      },
{
        title: "Tree Island Steel outlook suffer from demand, regulations",
        date: "05/03/2024",
        content: "Tree Island Steel, a Canadian steel manufacturer, faces challenges due to a volatile market and stricter regulations.This is partly due to lower demand from customers and tighter control on inventory levels. Additionally, increasing environmental and trade restrictions could further impact their financial performance in the future.",
        location: [ -122.95856329291924,49.18724228448802,]
      },
{
  "title": "RMI, Acction needed to accelerate "green iron corridors" ",
  "date": "05/03/2024",
  "content": "Rocky Mountain Institute suggests that "Green iron corridors" offer a cost-effective solution for steelmakers to source low-emission iron and transition to greener production.",
  "location": [-107.03818902488453,39.368726255759135, ]
},
{
  "title": "Construction to drag on EU steel-using growth: Eurofer",
  "date": "05/03/2024",
  "content": "Continued construction sector recession will be the main drag on European steel-using sector growth in 2024, with metal goods and mechanical engineering also expected to perform badly.",
  "location": [ 4.391386734802717,50.84612562853744,]
},
{
        title: "Germany’s stockholder's sales fall",
        date: "05/03/2024",
        content: "Sales by Germany’s stockholding distributors in the first quarter totalled 823,000 tonnes, which is 12% lower than in the corresponding previous-year quarter. This reflects the slowdown of business in construction.",
        location: [13.377494859343154,52.51868332924033]
      },
  {
        title: "VSSL approves billet capacity addition investment",
        date: "05/03/2024",
        content: "Indian specialty steelmaker Vardhman Specialty Steel (VSSL) is expanding its steel melting shop capacity by 25,000 tonnes/year with an investment of INR 330 million ($3.95m). ",
        location: [75.90666726768238,30.88749266654006]
      },
      // Add more articles here
    ];


    newsArticles.forEach(article => {
      const marker = new mapboxgl.Marker()
        .setLngLat(article.location)
        .addTo(map);

      const popupContent = `
        <strong>Title:</strong> ${article.title}<br>
        <strong>Date:</strong> ${article.date}<br>
        <p>${article.content}</p>
      `;
      
      const popup = new mapboxgl.Popup({ offset: 25 })
        .setHTML(popupContent);

      marker.setPopup(popup);
    });

    // Globe spinning logic
    const secondsPerRevolution = 240;
    let userInteracting = false;
    let spinEnabled = true;

    function spinGlobe() {
        if (spinEnabled && !userInteracting) {
            let distancePerSecond = 360 / secondsPerRevolution;
            const center = map.getCenter();
            center.lng -= distancePerSecond;
            map.easeTo({ center, duration: 1000, easing: (n) => n });
        }
    }

    map.on('click', () => {
        userInteracting = true;
        spinEnabled = false; // Stop spinning when map is clicked
    });

    map.on('moveend', () => {
        if (!userInteracting) {
            spinGlobe(); // Resume spinning only if user interaction flag is reset
        }
    });

    spinGlobe();
  </script>
</body>
</html>
