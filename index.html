<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Steel News Satellite</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <!-- Include the Mapbox GL CSS -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body, html { height: 100%; margin: 0; padding: 0; display: flex; }
    #news-list { width: 33.33%; padding: 10px; box-sizing: border-box; overflow-y: auto; background-color: #f9f9f9; }
    #map { width: 66.67%; height: 100%; }
    .news-item { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; background-color: #fff; cursor: pointer; }
    .news-item:hover { background-color: #eee; }
  </style>
</head>
<body>
  <div id="news-list"></div>
  <div id="map"></div>
  <!-- Include the Mapbox GL JS -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js'></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFydWNoYW5uIiwiYSI6ImNsdnFlZWRidTAyNmkya21yem1wMjhzZHUifQ.GrEXJlVvv0ljdkQXoEQTTQ';
    const map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/haruchann/clvqqksup01r901qpg3d0hynv', // style URL
      center: [31.261181743597245,30.033253480264698], // initial center coordinates
      zoom: 1.9, // initial zoom
      pitch: 0, // pitch in degrees
      bearing: 0 // bearing in degrees
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style
    });

    const newsArticles = [
      {
        title: "Vietnam targets higher steel output, lower emissions",
        date: "05/13/2024",
        content: "Vietnam could produce 51 million tonnes of crude steel in 2050, Vietnam Steel Association (VSA) secretary general and vice chairman Dinh Quoc Thai said at Monday’s South East Asian Iron and Steel Institute (Seaisi) annual conference.",
        location: [105.8148158587074,21.01580842214596]
      },
      {
        title: "ArcelorMittal Restocking Outlook",
        date: "05/03/2024",
        content: "ArcelorMittal observes a waiting period for a rebound in restocking. Sentiment stabilizes, awaiting consumption increase due to low inventory levels. Maintains global steel demand growth forecast for 2024. Q1 shows declines in production, shipments, net profit, and Ebitda, but revenue grows compared to Q4 2023. European steel spreads improve, US prices stabilize influenced by low inventory. Challenges noted from China’s excess steel production and rising exports. Focus on upcoming projects for low-emission steel supply.",
        location: [6.143465193777926,49.62180385642374]
      }
    ];

    const newsList = document.getElementById('news-list');

    newsArticles.forEach(article => {
      const newsItem = document.createElement('div');
      newsItem.className = 'news-item';
      newsItem.innerText = article.title;
      newsItem.addEventListener('click', () => {
        map.flyTo({
          center: article.location,
          zoom: 10,
          essential: true
        });
      });
      newsList.appendChild(newsItem);
    });

    newsArticles.forEach(article => {
      const marker = new mapboxgl.Marker()
        .setLngLat(article.location)
        .addTo(map);

      const popupContent = `
        <strong>Title:</strong> ${article.title}<br>
        <strong>Date:</strong> ${article.date}<br>
        <p>${article.content}</p>
      `;
      
      const popup = new mapboxgl.Popup({ offset: 25 })
        .setHTML(popupContent);

      marker.setPopup(popup);
    });

    // Globe spinning logic
    const secondsPerRevolution = 240;
    let userInteracting = false;
    let spinEnabled = true;

    function spinGlobe() {
        if (spinEnabled && !userInteracting) {
            let distancePerSecond = 360 / secondsPerRevolution;
            const center = map.getCenter();
            center.lng -= distancePerSecond;
            map.easeTo({ center, duration: 1000, easing: (n) => n });
        }
    }

    map.on('click', () => {
        userInteracting = true;
        spinEnabled = false; // Stop spinning when map is clicked
    });

    map.on('moveend', () => {
        if (!userInteracting) {
            spinGlobe(); // Resume spinning only if user interaction flag is reset
        }
    });

    spinGlobe();
  </script>
</body>
</html>
